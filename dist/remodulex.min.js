"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),React__default=_interopDefault(React),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),defineProperty=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},objectWithoutProperties=function(e,t){var r={};for(var n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,o=!1,u=void 0;try{for(var i,a=e[Symbol.iterator]();!(n=(i=a.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,u=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw u}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},isUndefined=function(e){return void 0===e},isNull=function(e){return null===e},isFunction=function(e){return"function"==typeof e},isArray=function(e){return e instanceof Array},isObject=function(e){return"object"===(void 0===e?"undefined":_typeof(e))&&!(isArray(e)||isNull(e))},isString=function(e){return"string"==typeof e},get$1=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],r=arguments[2];try{var n=(isString(t)?t.split("."):t).reduce(function(e,t){return e[t]},e);return isUndefined(n)?r:n}catch(e){return r}},run=function(e){for(var t=arguments.length,r=Array(2<t?t-2:0),n=2;n<t;n++)r[n-2]=arguments[n];var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];o=isString(o)?o.split("."):o;var u=get$1(e,o),i=get$1(e,o.slice(0,-1));return isFunction(u)?u.call.apply(u,[i].concat(r)):u},value=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce(function(e,t){return isUndefined(e)?run(t):run(e)},void 0)},__modules={},getModules=function(){return __modules},hasModule=function(e){return!!__modules[e]},saveModule=function(e,t){__modules[e]=t},mapModules=function(e,s){if(isArray(e)){var t=[].concat(toConsumableArray(e));e=function(r){return t.reduce(function(e,t){return r[t]?_extends({},e,defineProperty({},t,r[t])):e},{})}}var r=value(run(e,void 0,getModules()),{});return Object.entries(r).reduce(function(e,t){var r=slicedToArray(t,2),n=r[0],o=r[1],u=o.dispatch,i=o.commit,a=o.compute,c=o.getState;return _extends({},e,defineProperty({},n,value(function(){var e=c(s);return{getState:c,getComputed:function(){return a(c())},dispatch:u,commit:i,state:e,getters:a(e)}})))},{})},__store=void 0,check=function(n){return function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return __store||console.error(new Error("\n      [ReModulex Error] \n        Forgot to apply the store?\n        Use 'ReModulex.applyStore' with your redux store!\n    ")),run.apply(void 0,[n,void 0].concat(t))}},applyStore=function(e){__store=e},dispatch=check(function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return run.apply(void 0,[__store,"dispatch"].concat(t))}),getState=check(function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return run.apply(void 0,[__store,"getState"].concat(t))}),__splitter="Y(^_^)Y",combine=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.join(__splitter)},split=function(e,r,n){return e.split(__splitter).reduce(function(e,t){return _extends({},e,defineProperty({},n+"::"+t,r))},{})},memoize=function(u){var i=new Map,e=function(e){if(i.has(e))return i.get(e);for(var t=arguments.length,r=Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var o=u.call.apply(u,[this,e].concat(r));return i.set(e,o),o};return e.cache=i,e},ReModulex=function e(t){var u=t.name,r=t.state,n=objectWithoutProperties(t,["name","state"]);if(classCallCheck(this,e),_initialiseProps.call(this),hasModule(u))throw new Error("\n        [Creating ReModulex Error] Duplicated module named '"+u+"'\n      ");if(!isObject(r))throw new Error("\n        [Creating ReModulex Error] Initial state must be an Object!\n      ");var o=_extends({__ReModulexName:u},r),i=Object.entries(run(n,"mutations",{combine:combine})).reduce(function(e,t){var r=slicedToArray(t,2),n=r[0],o=r[1];return _extends({},e,split(n,o,u))},{}),a=run(n,"actions",{getModules:getModules,getStoreState:getState,dispatch:this.dispatch,commit:this.commit,getState:this.getState});saveModule(u,Object.assign(this,{name:u,getters:get$1(n,"getters",{}),actions:a,reducer:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:o,t=arguments[1],r=t.type,n=t.payload;return _extends({},e,run(i,r,e,n))}})),Object.assign(this.dispatch,a)},_initialiseProps=function(){var i=this;this.dispatch=function(){for(var e=arguments.length,t=Array(1<e?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return run.apply(void 0,[i.actions,n.split("/")].concat(t))},this.commit=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=arguments[1];return dispatch({type:i.name+"::"+e,payload:t})},this.compute=function(t){var r=memoize(function(e){return run(i.getters,e,t,r)});return Object.keys(i.getters).reduce(function(e,t){return _extends({},e,defineProperty({},t,r(t)))},{})},this.getState=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:getState();if(e.__ReModulexName===i.name)return e;var t=get$1(e,i.__storeKeyCache);if(get$1(t,"__ReModulexName")===i.name)return t;var r=Object.entries(e).find(function(e){var t=slicedToArray(e,2),r=(t[0],t[1]);return get$1(r,"__ReModulexName")===i.name}),n=slicedToArray(r,2),o=n[0],u=n[1];return i.__storeKeyCache=o,u}},REACT_STATICS={childContextTypes:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},KNOWN_STATICS={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},defineProperty$1=Object.defineProperty,getOwnPropertyNames=Object.getOwnPropertyNames,getOwnPropertySymbols=Object.getOwnPropertySymbols,getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,getPrototypeOf=Object.getPrototypeOf,objectPrototype=getPrototypeOf&&getPrototypeOf(Object);function hoistNonReactStatics(e,t,r){if("string"==typeof t)return e;if(objectPrototype){var n=getPrototypeOf(t);n&&n!==objectPrototype&&hoistNonReactStatics(e,n,r)}var o=getOwnPropertyNames(t);getOwnPropertySymbols&&(o=o.concat(getOwnPropertySymbols(t)));for(var u=0;u<o.length;++u){var i=o[u];if(!(REACT_STATICS[i]||KNOWN_STATICS[i]||r&&r[i])){var a=getOwnPropertyDescriptor(t,i);try{defineProperty$1(e,i,a)}catch(e){}}}return e}var hoistNonReactStatics_cjs=hoistNonReactStatics,ReModulexContext=value(function(){try{return React.createContext()}catch(e){return console.warn(new Error("\n      [ReModulex Environment Waring] \n        'createContext' API is not supported by your React version. \n        'ModuleProvider' and 'connectModules' would NOT effect.\n        Use 'applyStore' and 'mapModules' with 'Provider' and 'connect' in react-redux instead.        \n    ")),{Provider:function(e){var t=e.children;return run(t)},Consumer:function(e){var t=e.children;return run(t)}}}}),Provider=ReModulexContext.Provider,Consumer=ReModulexContext.Consumer,ModuleProvider=function(e){function a(e){var t;classCallCheck(this,a);for(var r=e.store,n=arguments.length,o=Array(1<n?n-1:0),u=1;u<n;u++)o[u-1]=arguments[u];var i=possibleConstructorReturn(this,(t=a.__proto__||Object.getPrototypeOf(a)).call.apply(t,[this,e].concat(o)));return i.state=i.props.store.getState(),applyStore(r),i.unsubscibe=r.subscribe(function(){return i.setState(i.props.store.getState())}),i}return inherits(a,e),createClass(a,[{key:"componentWillUnmount",value:function(){run(this.unsubscibe)}},{key:"render",value:function(){return React__default.createElement(Provider,{value:this.state},this.props.children)}}]),a}(React.Component),connectModules=function(o){return function(n){var e=React.forwardRef(function(t,r){return React__default.createElement(Consumer,null,function(e){return React__default.createElement(n,_extends({},t,mapModules(o,e),{ref:r}))})});return e.displayName="HOC-ReModulex("+value(n.displayName,n.name)+")",hoistNonReactStatics_cjs(e,n)}},useModules=function(e){if(!isFunction(React.useContext))return console.warn("\n      [ReModulex Environment Waring] \n        'useContext' API is not supported by your React version.\n        YOU CAN NOT use 'useModules' api unless upgrade React\n    ");var t=React.useContext(ReModulexContext);return mapModules(e,t)},useModule=function(e){return get$1(useModules([e]),e)},createModule=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return new(Function.prototype.bind.apply(ReModulex,[null].concat(t)))};exports.createModule=createModule,exports.mapModules=mapModules,exports.applyStore=applyStore,exports.ModuleProvider=ModuleProvider,exports.connectModules=connectModules,exports.useModules=useModules,exports.useModule=useModule;
